\documentclass[output=book
                ,multiauthors
	        ,collection
	        ,collectionchapter
%,uniformtopskip % to avoid bug in cl chapter
 	        ,biblatex  
                ,babelshorthands
%                ,showindex
                ,newtxmath
                ,uniformtopskip
%                ,colorlinks, citecolor=brown 
                ,draftmode
		  ]{langscibook}                              
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% for color coding to work for trees you have to disable memoize
%\usepackage{nomemoize} 

\usepackage{memoize} 
% these values have to be set below after loading and defining todo-commands.
% \memoizeset{
%    memo filename prefix={chapters/hpsg-handbook.memo.dir/},
%    register=\todo{O{}+m},
%    prevent=\todo,
% }


\memoizeset{readonly}

% put all additional commands you need in the 
% following files. If you do not know what this might 
% mean, you can safely ignore this section

\input{localmetadata.tex}
\input{localpackages.tex}
\input{localhyphenation.tex}
\input{localcommands.tex} 

\input{locallangscifixes.tex}
\input{localtemporaryfixes.tex}

% https://tex.stackexchange.com/a/111851/18561
\DeclareSourcemap{
    \maps[datatype=bibtex]{
      \map{
        \step[fieldsource=checked]
        \step[fieldset=usera,origfieldval]
    }
  }
}

%\DeclareFieldFormat{usera}{\red{#1}}

% This shows the value of checked:
%\AtEveryBibitem{
%\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{usera}{\space \red{Not checked!}}{\space\green{\printfield{usera}}}}
%}
% This just shows a warning for unchecked items
\AtEveryBibitem{
\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{usera}{\space \red{Not checked!}}{}}
}

% for color coding to work for trees you have to disable memoize
%\usepackage{nomemoize} 

%\usepackage{memoize} 
\memoizeset{
   memo filename prefix={chapters/hpsg-handbook.memo.dir/},
   register=\todo{O{}+m},
   prevent=\todo,
}


%\memoizeset{readonly}




%\includeonly{chapters/preface,chapters/properties,chapters/evolution,chapters/formal-background}
%\includeonly{chapters/properties,chapters/evolution}

%\includeonly{chapters/preface}
%\includeonly{chapters/properties}
%\includeonly{chapters/evolution}
%\includeonly{chapters/formal-background}
%\includeonly{chapters/understudied-languages}
%\includeonly{chapters/agreement}
%\includeonly{chapters/lexicon}
%\includeonly{chapters/arg-st}
%\includeonly{chapters/negation}
%\includeonly{chapters/ellipsis}
%\includeonly{chapters/order}
%\includeonly{chapters/case}
%\includeonly{chapters/udc}
%\includeonly{chapters/coordination}
%\includeonly{chapters/control-raising}
%\includeonly{chapters/np}
%\includeonly{chapters/relative-clauses}
%\includeonly{chapters/islands}
%\includeonly{chapters/complex-predicates}
%\includeonly{chapters/idioms}
%\includeonly{chapters/binding}

%\includeonly{chapters/morphology}
%\includeonly{chapters/semantics}
%\includeonly{chapters/information-structure}
%\includeonly{chapters/processing}
\includeonly{chapters/pragmatics}
%\includeonly{chapters/gesture}
%\includeonly{chapters/cl}
%\includeonly{chapters/cl,chapters/dg,chapters/cg,chapters/lfg,chapters/minimalism,chapters/cxg}

%\includeonly{chapters/dg}
%\includeonly{chapters/cg}
%\includeonly{chapters/lfg}
%\includeonly{chapters/minimalism}
%\includeonly{chapters/cxg}


\input{bibliographies-include}

\usepackage{xassoccnt}
\newcounter{realpage}
\DeclareAssociatedCounters{page}{realpage}
\AtBeginDocument{%
  \stepcounter{realpage}
}

% Morning is broooooken
%\usepackage{chappg}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%             Frontmatter                      %%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}         
\memoizedisable
\maketitle
\frontmatter
\memoizeenable
% %% uncomment if you have preface and/or acknowledgements

\currentpdfbookmark{Contents}{name} % adds a PDF bookmark
\tableofcontents
\include{chapters/preface}
\include{chapters/acknowledgments}

%% Additional prefaces and/or introductions that also have authors
%\lsCollectionPaperFrontmatterMode % Enter the Frontmatter Mode. 
%\include{chapters/prefaceEd}
% \include{chapters/prefaceEd2}
%\lsCollectionPaperMainmatterMode % Leave the Frontmatter Mode 
\setcounter{chapter}{0} % Reset the chapter counter so that preceeding prefaces are not counted
%%
\mainmatter          

\typeout{mainmatter starts at \therealpage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%             Chapters                         %%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Uncomment the chapter(s) you would like to check

\part{Introduction}

\includepaper{chapters/properties}
\includepaper{chapters/evolution} 
\includepaper{chapters/formal-background}
\includepaper{chapters/lexicon}
\includepaper{chapters/understudied-languages}
% 
\part{Syntactic phenomena}

\includepaper{chapters/agreement}
\includepaper{chapters/case}
\includepaper{chapters/np}
\includepaper{chapters/arg-st}
\includepaper{chapters/order}
\includepaper{chapters/clitics}
\includepaper{chapters/complex-predicates}
\includepaper{chapters/control-raising}
\includepaper{chapters/udc}
\includepaper{chapters/relative-clauses}
\includepaper{chapters/islands}
\includepaper{chapters/coordination}
\includepaper{chapters/idioms}
\includepaper{chapters/negation}
\includepaper{chapters/ellipsis}
\includepaper{chapters/binding}
%
\part{Other levels of description}

\includepaper{chapters/morphology}
\includepaper{chapters/semantics}
\includepaper{chapters/information-structure}
%
\part{Other areas of linguistics}

%\includepaper{chapters/acquisition}
\includepaper{chapters/processing}
\includepaper{chapters/cl}
\includepaper{chapters/pragmatics}
\includepaper{chapters/sign-lg}
\includepaper{chapters/gesture}
%
\part{The broader picture}
\includepaper{chapters/minimalism}
\includepaper{chapters/cg}
\includepaper{chapters/lfg}
\includepaper{chapters/dg}
\includepaper{chapters/cxg}
% %	
% copy the lines above and adapt as necessary

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%             Backmatter                       %%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% There is normally no need to change the backmatter section
\memoizedisable

\input{backmatter.tex}

\end{document} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%                  END                         %%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
