%% -*- coding:utf-8 -*-

\documentclass[output=book
                ,multiauthors
	        ,collection
	        ,collectionchapter
 	        ,biblatex  
                ,babelshorthands
%                ,showindex
                ,newtxmath
%                ,colorlinks, citecolor=brown 
                ,draftmode
% 	        ,coverus
		  ]{langscibook}                              


% put all additional commands you need in the 
% following files. If you do not know what this might 
% mean, you can safely ignore this section

\input{localmetadata.tex}
\input{localpackages.tex}
\input{localhyphenation.tex}
\input{localcommands.tex} 

\input{locallangscifixes.tex}

\hypersetup{pdfborder={0 0 0}}  % for hyperref

% https://tex.stackexchange.com/a/111851/18561
\DeclareSourcemap{
    \maps[datatype=bibtex]{
      \map{
        \step[fieldsource=checked]
        \step[fieldset=usera,origfieldval]
    }
  }
}

\DeclareSourcemap{
    \maps[datatype=bibtex]{
      \map{
        \step[fieldsource=urldate]
        \step[fieldset=userb,origfieldval]
    }
  }
}


%\DeclareFieldFormat{usera}{\red{#1}}

\AtEveryBibitem{
% not checked = red, checked = green
%\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{usera}{\space \red{Not
%checked!}}{\space\green{\printfield{usera}}}}
%
% just not checked = red
\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{usera}{\space \red{Not checked!}}{}}
% url but no urldate
\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{url}{}{\iffieldundef{userb}{\space \red{access date missing}{}}}}
% series but no number
% does not work since "none" values are dropped and not contained in the bibliography drawn from handbook.bcf 
%\csappto{blx@bbx@\thefield{entrytype}}{\iffieldundef{series}{}{\iffieldundef{number}{\space \red{number is missing}}{}}}
}


\bibliography{hpsg-handbook-bibliography}

%\bibliography{test.bib}

\begin{document}
\nocite{*}

\printbibliography
\end{document}